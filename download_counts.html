<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Counts</title>
</head>
<body>
    <h1>Combined Download Counts for Repositories</h1>
    
    <form id="repo-form">
        <label for="username">GitHub Username:</label>
        <input type="text" id="username" name="username" required>
        <br>
        <label for="token">GitHub Access Token:</label>
        <input type="text" id="token" name="token" required>
        <br>
        <button type="submit">Get Download Counts</button>
    </form>
    
    <div id="results"></div>

    <script>
    /*
        async function getUserRepos(username, token) {
            const url = `https://api.github.com/users/${username}/repos`;
            const response = await fetch(url, {
                headers: {
                    'Authorization': `token ${token}`
                }
            });
            return await response.json();
        }*/

        function getUserRepos(username, token, page = 1) {
            let repos = [];
            fetch(`https://api.github.com/users/${username}/repos?page=${page}&per_page=100`, {
                headers: {
                    'Authorization': `token ${token}`
                }
            })
            .then(response => response.json())
            .then(repos => {
                //const repoList = document.getElementById('repoList');
                debugger;
                repos.forEach(repo => {
                    //const listItem = document.createElement('li');
                    //listItem.textContent = repo.name;
                    //repoList.appendChild(listItem);
                    repos.add(repo);
                });
                if (repos.length === 100) {
                    getUserRepos(username, token, page + 1);
                }
            })
            .catch(error => {
                console.error('Error fetching repos:', error);
            });

            return repos;
        }

        async function getReleaseDownloads(owner, repo, token) {
            const url = `https://api.github.com/repos/${owner}/${repo}/releases`;
            const response = await fetch(url, {
                headers: {
                    'Authorization': `token ${token}`
                }
            });
            const releases = await response.json();

            let totalDownloads = 0;

            releases.forEach(release => {
                release.assets.forEach(asset => {
                    totalDownloads += asset.download_count;
                });
            });

            return totalDownloads;
        }

        async function main(username, token) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            let combinedDownloads = 0;

            const repos = await getUserRepos(username, token);

            for (const repo of repos) {
                debugger;
                const downloads = await getReleaseDownloads(username, repo.name, token);
                const repoResult = document.createElement('p');
                repoResult.textContent = `Total downloads for ${repo.name}: ${downloads}`;
                resultsDiv.appendChild(repoResult);
                combinedDownloads += downloads;
            }

            const combinedResult = document.createElement('p');
            combinedResult.innerHTML = `<strong>Combined downloads for all repositories: ${combinedDownloads}</strong>`;
            resultsDiv.appendChild(combinedResult);
        }

        document.getElementById('repo-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const token = document.getElementById('token').value;
            main(username, token);
        });
    </script>
</body>
</html>
``` â–‹
